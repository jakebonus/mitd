(function(b){var d=new Array();var a=new Array();b.fn.doAutosize=function(l){var j=b(this).data("minwidth"),f=b(this).data("maxwidth"),k="",g=b(this),n=b("#"+b(this).data("tester_id"));if(k===(k=g.val())){return}var p=k.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");n.html(p);var h=n.width(),e=(h+l.comfortZone)>=j?h+l.comfortZone:j,q=g.width(),m=(e<q&&e>=j)||(e>j&&e<f);if(m){g.width(e)}};b.fn.resetAutosize=function(l){var h=b(this).data("minwidth")||l.minInputWidth||b(this).width(),f=b(this).data("maxwidth")||l.maxInputWidth||(b(this).closest(".tagsinput").width()-l.inputPadding),g="",e=b(this),j=b("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),letterSpacing:e.css("letterSpacing"),whiteSpace:"nowrap"}),k=b(this).attr("id")+"_autosize_tester";if(!b("#"+k).length>0){j.attr("id",k);j.appendTo("body")}e.data("minwidth",h);e.data("maxwidth",f);e.data("tester_id",k);e.css("width",h)};b.fn.addTag=function(f,e){e=jQuery.extend({focus:false,callback:true},e);this.each(function(){var j=b(this).attr("id");var l=b(this).val().split(d[j]);if(l[0]==""){l=new Array()}f=jQuery.trim(f);if(e.unique){var g=b(this).tagExist(f);if(g==true){b("#"+j+"_tag").addClass("not_valid")}}else{var g=false}if(f!=""&&g!=true){b("<span>").addClass("tag").append(b("<span>").text(f).append("&nbsp;&nbsp;"),b("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return b("#"+j).removeTag(escape(f))})).insertBefore("#"+j+"_addTag");l.push(f);b("#"+j+"_tag").val("");if(e.focus){b("#"+j+"_tag").focus()}else{b("#"+j+"_tag").blur()}b.fn.tagsInput.updateTagsField(this,l);if(e.callback&&a[j]&&a[j]["onAddTag"]){var h=a[j]["onAddTag"];h.call(this,f)}if(a[j]&&a[j]["onChange"]){var k=l.length;var h=a[j]["onChange"];h.call(this,b(this),l[k-1])}}});return false};b.fn.removeTag=function(e){e=unescape(e);this.each(function(){var h=b(this).attr("id");var j=b(this).val().split(d[h]);b("#"+h+"_tagsinput .tag").remove();str="";for(i=0;i<j.length;i++){if(j[i]!=e){str=str+d[h]+j[i]}}b.fn.tagsInput.importTags(this,str);if(a[h]&&a[h]["onRemoveTag"]){var g=a[h]["onRemoveTag"];g.call(this,e)}});return false};b.fn.tagExist=function(e){var f=b(this).attr("id");var g=b(this).val().split(d[f]);return(jQuery.inArray(e,g)>=0)};b.fn.importTags=function(e){var f=b(this).attr("id");b("#"+f+"_tagsinput .tag").remove();b.fn.tagsInput.importTags(this,e)};b.fn.tagsInput=function(g){var f=jQuery.extend({interactive:true,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:false},hide:true,delimiter:",",unique:true,removeWithBackspace:true,placeholderColor:"#666666",autosize:true,comfortZone:20,inputPadding:6*2},g);var e=0;this.each(function(){if(typeof b(this).attr("data-tagsinput-init")!=="undefined"){return}b(this).attr("data-tagsinput-init",true);if(f.hide){b(this).hide()}var k=b(this).attr("id");if(!k||d[b(this).attr("id")]){k=b(this).attr("id","tags"+new Date().getTime()+(e++)).attr("id")}var j=jQuery.extend({pid:k,real_input:"#"+k,holder:"#"+k+"_tagsinput",input_wrapper:"#"+k+"_addTag",fake_input:"#"+k+"_tag"},f);d[k]=j.delimiter;if(f.onAddTag||f.onRemoveTag||f.onChange){a[k]=new Array();a[k]["onAddTag"]=f.onAddTag;a[k]["onRemoveTag"]=f.onRemoveTag;a[k]["onChange"]=f.onChange}var h='<div id="'+k+'_tagsinput" class="tagsinput"><div id="'+k+'_addTag">';if(f.interactive){h=h+'<input id="'+k+'_tag" value="" data-default="'+f.defaultText+'" />'}h=h+'</div><div class="tags_clear"></div></div>';b(h).insertAfter(this);b(j.holder).css("width",f.width);b(j.holder).css("min-height",f.height);b(j.holder).css("height",f.height);if(b(j.real_input).val()!=""){b.fn.tagsInput.importTags(b(j.real_input),b(j.real_input).val())}if(f.interactive){b(j.fake_input).val(b(j.fake_input).attr("data-default"));b(j.fake_input).css("color",f.placeholderColor);b(j.fake_input).resetAutosize(f);b(j.holder).bind("click",j,function(l){b(l.data.fake_input).focus()});b(j.fake_input).bind("focus",j,function(l){if(b(l.data.fake_input).val()==b(l.data.fake_input).attr("data-default")){b(l.data.fake_input).val("")}b(l.data.fake_input).css("color","#000000")});if(f.autocomplete_url!=undefined){autocomplete_options={source:f.autocomplete_url};for(attrname in f.autocomplete){autocomplete_options[attrname]=f.autocomplete[attrname]}if(jQuery.Autocompleter!==undefined){b(j.fake_input).autocomplete(f.autocomplete_url,f.autocomplete);b(j.fake_input).bind("result",j,function(n,m,l){if(m){b("#"+k).addTag(m[0]+"",{focus:true,unique:(f.unique)})}})}else{if(jQuery.ui.autocomplete!==undefined){b(j.fake_input).autocomplete(autocomplete_options);b(j.fake_input).bind("autocompleteselect",j,function(m,l){b(m.data.real_input).addTag(l.item.value,{focus:true,unique:(f.unique)});return false})}}}else{b(j.fake_input).bind("blur",j,function(m){var l=b(this).attr("data-default");if(b(m.data.fake_input).val()!=""&&b(m.data.fake_input).val()!=l){if((m.data.minChars<=b(m.data.fake_input).val().length)&&(!m.data.maxChars||(m.data.maxChars>=b(m.data.fake_input).val().length))){b(m.data.real_input).addTag(b(m.data.fake_input).val(),{focus:true,unique:(f.unique)})}}else{b(m.data.fake_input).val(b(m.data.fake_input).attr("data-default"));b(m.data.fake_input).css("color",f.placeholderColor)}return false})}b(j.fake_input).bind("keypress",j,function(l){if(c(l)){l.preventDefault();if((l.data.minChars<=b(l.data.fake_input).val().length)&&(!l.data.maxChars||(l.data.maxChars>=b(l.data.fake_input).val().length))){b(l.data.real_input).addTag(b(l.data.fake_input).val(),{focus:true,unique:(f.unique)})}b(l.data.fake_input).resetAutosize(f);return false}else{if(l.data.autosize){b(l.data.fake_input).doAutosize(f)}}});j.removeWithBackspace&&b(j.fake_input).bind("keydown",function(n){if(n.keyCode==8&&b(this).val()==""){n.preventDefault();var l=b(this).closest(".tagsinput").find(".tag:last").text();var m=b(this).attr("id").replace(/_tag$/,"");l=l.replace(/[\s]+x$/,"");b("#"+m).removeTag(escape(l));b(this).trigger("focus")}});b(j.fake_input).blur();if(j.unique){b(j.fake_input).keydown(function(l){if(l.keyCode==8||String.fromCharCode(l.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)){b(this).removeClass("not_valid")}})}}});return this};b.fn.tagsInput.updateTagsField=function(e,g){var f=b(e).attr("id");b(e).val(g.join(d[f]))};b.fn.tagsInput.importTags=function(j,e){b(j).val("");var k=b(j).attr("id");var g=e.split(d[k]);for(i=0;i<g.length;i++){b(j).addTag(g[i],{focus:false,callback:false})}if(a[k]&&a[k]["onChange"]){var h=a[k]["onChange"];h.call(j,j,g[i])}};var c=function(f){var e=false;if(f.which==13){return true}if(typeof f.data.delimiter==="string"){if(f.which==f.data.delimiter.charCodeAt(0)){e=true}}else{b.each(f.data.delimiter,function(g,h){if(f.which==h.charCodeAt(0)){e=true}})}return e}})(jQuery);